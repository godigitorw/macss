// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String
  role      Role     @default(USER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  properties Property[]
  submissions PropertySubmission[]
}

enum Role {
  USER
  ADMIN
}

model Property {
  id          String   @id @default(cuid())
  title       String
  description String   @db.Text
  type        PropertyType
  status      PropertyStatus
  price       Float
  bedrooms    Int?
  bathrooms   Int?
  area        Float?
  parkingSpaces Int?

  // Location
  district    String
  sector      String
  address     String

  // Images
  images      String[]

  // Features
  amenities   String[]

  // Contact
  contactName  String
  contactEmail String
  contactPhone String

  inquiries   PropertyInquiry[]

  featured    Boolean  @default(false)
  views       Int      @default(0)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([status])
  @@index([type])
  @@index([district])
  @@index([createdAt])
}

enum PropertyType {
  HOUSE
  APARTMENT
  LAND
  COMMERCIAL
  OFFICE
  WAREHOUSE
}

enum PropertyStatus {
  FOR_SALE
  FOR_RENT
  SOLD
  RENTED
}

model PropertyTypeConfig {
  id          String   @id @default(cuid())
  name        String   @unique // e.g., "HOUSE", "APARTMENT"
  displayName String   // e.g., "House", "Luxury Apartment"
  description String?  @db.Text
  icon        String?  // React Icon name (e.g., "FiHome", "FiBuilding")
  isActive    Boolean  @default(true)
  order       Int      @default(0) // For sorting
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([isActive])
  @@index([order])
}



model PropertySubmission {
  id          String   @id @default(cuid())

  // Property Details
  propertyType String
  listingType  String
  title        String
  description  String   @db.Text

  // Location
  district     String
  sector       String
  address      String

  // Features
  bedrooms     String?
  bathrooms    String?
  area         String?
  parkingSpaces String?

  // Pricing
  price        String
  negotiable   Boolean  @default(false)
  amenities    String[]
  images       String[]

  // Owner Information
  ownerName    String
  ownerEmail   String
  ownerPhone   String
  additionalInfo String? @db.Text

  // Status
  status       SubmissionStatus @default(PENDING)
  reviewedBy   String?
  reviewedAt   DateTime?
  rejectionReason String?

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  userId       String?
  user         User?    @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([status])
  @@index([createdAt])
}

enum SubmissionStatus {
  PENDING
  APPROVED
  REJECTED
}

model PropertyInquiry {
  id          String   @id @default(cuid())
  
  propertyId  String
  property    Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  
  name        String
  email       String
  phone       String
  message     String   @db.Text
  
  status      InquiryStatus @default(PENDING)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([propertyId])
  @@index([status])
}

enum InquiryStatus {
  PENDING
  CONTACTED
  CLOSED
}
